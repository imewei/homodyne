# Diff 2: device/config.py - Remove should_use_cmc()
# Apply with: git apply docs/refactor/diffs/02-device-config-removal.diff
#
# This diff:
# - Removes should_use_cmc() function (no longer needed)
# - Updates __all__ export list
# - Keeps HardwareConfig and detect_hardware() (used by CMC coordinator)

--- a/homodyne/device/config.py
+++ b/homodyne/device/config.py
@@ -1,44 +1,23 @@
 """Hardware Detection and Configuration for Consensus Monte Carlo
 ================================================================

 This module provides hardware-adaptive detection and decision-making for
 CMC (Consensus Monte Carlo) optimization. It determines when to use CMC
-based on available hardware resources and dataset characteristics using
-a tri-criteria OR logic system.
+based on available hardware resources.

 Key Features
 ------------
 - Automatic CPU device detection (CPU-only in v2.3.0+)
 - System memory detection with psutil
 - Cluster environment detection (PBS/Slurm)
-- Hardware-adaptive CMC threshold selection
-- Tri-criteria decision logic (parallelism OR memory OR large dataset)
 - Backend recommendation based on hardware capabilities

 Usage
 -----
-    from homodyne.device.config import detect_hardware, should_use_cmc
+    from homodyne.device.config import detect_hardware, HardwareConfig

     # Detect hardware capabilities
     hw_config = detect_hardware()
     print(f"Platform: {hw_config.platform}")
     print(f"Recommended backend: {hw_config.recommended_backend}")
-
-    # Decide whether to use CMC for a dataset
-    dataset_size = 5_000_000
-    use_cmc = should_use_cmc(dataset_size, hw_config)
-    print(f"Use CMC for {dataset_size} points: {use_cmc}")

 Integration
 -----------
 This module is called by:
-- fit_mcmc_jax() to determine method selection (NUTS vs CMC)
 - CMC coordinator to select optimal backend
 - Shard sizing calculations in CMC pipeline
-
-Notes
------
-- Hardware detection is performed once at import time
-- Results can be cached for performance
-- Fallback mechanisms ensure robustness
 """

 from dataclasses import dataclass
@@ -275,244 +254,8 @@ def detect_hardware() -> HardwareConfig:
     return hw_config


-def should_use_cmc(
-    num_samples: int,
-    hardware_config: HardwareConfig,
-    dataset_size: Optional[int] = None,
-    memory_threshold_pct: float = 0.20,
-    min_samples_for_cmc: int = 15,
-    large_dataset_threshold: int = 1_000_000,
-    large_dataset_threshold_low_sample: int = 10_000_000,
-) -> bool:
-    """Determine if CMC should be used based on samples AND/OR dataset size.
-
-    DEPRECATED: This function is no longer used in v3.0+.
-    All MCMC runs through CMC coordinator unconditionally.
-
-    CMC serves FOUR distinct purposes requiring different triggering conditions:
-
-    ... [docstring removed - function deleted]
-    """
-    # DELETED: Entire function body (~200 lines)
-    # CMC is now always used - shard count determines behavior
-    raise NotImplementedError(
-        "should_use_cmc() is deprecated in v3.0. "
-        "All MCMC runs through CMC coordinator. "
-        "Use CMCCoordinator directly with num_shards=1 for single-shard mode."
-    )
-
-
 # Export public API
 __all__ = [
     "HardwareConfig",
     "detect_hardware",
-    # "should_use_cmc",  # REMOVED in v3.0
 ]
