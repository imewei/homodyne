# ==============================================================================
# HOMODYNE LAMINAR FLOW CONFIGURATION
# ==============================================================================
# Optimized for laminar flow systems
#
# PARAMETER COUNT: 7 physical + 2 per angle
# Example: 3 angles → 7 + 2×3 = 13 total parameters
#
# Physical parameters:
#   - D₀: Initial diffusion coefficient [Å²/s]
#   - α: Diffusion power-law exponent [dimensionless]
#   - D_offset: Diffusion offset [Å²/s]
#   - γ̇₀: Initial shear rate [s⁻¹]
#   - β: Shear rate power-law exponent [dimensionless]
#   - γ̇_offset: Shear rate offset [s⁻¹]
#   - φ₀: Initial angle [degrees]
#
# Per-angle scaling: [contrast, offset] for each phi angle
#
# VERSION: 2.0.0
# UPDATED: 2025-10-24
# ==============================================================================

# ==============================================================================
# EXPERIMENTAL DATA
# ==============================================================================
experimental_data:
  file_path: "./data/sample/experiment.hdf"

# ==============================================================================
# PARAMETER SPACE - Laminar Flow Model (7 Physical Parameters)
# ==============================================================================
parameter_space:
  model: "laminar_flow"

  bounds:
    # -------------------------------------------------------------------------
    # DIFFUSION PARAMETERS
    # -------------------------------------------------------------------------
    # Diffusion coefficient D₀ [Å²/s]
    - name: D0
      min: 100.0
      max: 1e5

    # Anomalous exponent α [dimensionless]
    # 0 = normal diffusion, <1 = subdiffusion, >1 = superdiffusion
    - name: alpha
      min: 0.0
      max: 2.0

    # Diffusion offset D_offset [Å²/s]
    - name: D_offset
      min: -100.0
      max: 100.0

    # -------------------------------------------------------------------------
    # FLOW PARAMETERS
    # -------------------------------------------------------------------------
    # Initial shear rate γ̇₀ [s⁻¹]
    - name: gamma_dot_0                   # Maps to gamma_dot_t0 in code
      min: 1e-6
      max: 0.5

    # Shear rate exponent β [dimensionless]
    - name: beta
      min: 0.0
      max: 2.0

    # Shear rate offset γ̇_offset [s⁻¹]
    - name: gamma_dot_offset
      min: -0.1
      max: 0.1

    # Initial angle φ₀ [degrees]
    # Angle between flow direction and scattering vector
    - name: phi_0                         # Maps to phi0 in code
      min: -180.0
      max: 180.0

# ==============================================================================
# INITIAL PARAMETERS
# ==============================================================================
initial_parameters:
  # 7-parameter model: D₀, α, D_offset, γ̇₀, β, γ̇_offset, φ₀
  parameter_names:
    - D0
    - alpha
    - D_offset
    - gamma_dot_0
    - beta
    - gamma_dot_offset
    - phi_0

# ==============================================================================
# OPTIMIZATION METHODS
# ==============================================================================
optimization:
  method: "nlsq"

  # NLSQ Trust-Region Solver
  nlsq:
    max_iterations: 100
    tolerance: 1e-8
    trust_region_scale: 1.0

  # MCMC Uncertainty Quantification
  # Increased samples for higher-dimensional parameter space
  mcmc:
    num_warmup: 1000
    num_samples: 2000
    num_chains: 4
    progress_bar: true
    backend: "numpyro"

  # Streaming Optimization (for large datasets >100M points)
  streaming:
    enable_checkpoints: true
    checkpoint_dir: "./checkpoints"
    checkpoint_frequency: 10
    resume_from_checkpoint: true
    keep_last_checkpoints: 3
    enable_fault_tolerance: true
    max_retries_per_batch: 2
    min_success_rate: 0.5

  # CMC for Large Multi-Angle Datasets (>1M points)
  cmc:
    enable: false
    backend: "jax"
    diagonal_correction: true

# ==============================================================================
# PHI ANGLE FILTERING (Recommended for Laminar Flow)
# ==============================================================================
phi_filtering:
  enabled: true
  target_ranges:
    # Parallel to flow (0°)
    - min_angle: -10.0
      max_angle: 10.0
      description: "Near 0 degrees (parallel to flow)"

    # Perpendicular to flow (90°)
    - min_angle: 85.0
      max_angle: 95.0
      description: "Near 90 degrees (perpendicular to flow)"

# ==============================================================================
# PERFORMANCE
# ==============================================================================
performance:
  strategy_override: null                 # Automatic strategy selection
  memory_limit_gb: null                   # Auto-detect
  enable_progress: true                   # Show progress bars

  device:
    preferred_device: "auto"              # Auto GPU/CPU selection
    gpu_memory_fraction: 0.9

# ==============================================================================
# VISUALIZATION
# ==============================================================================
plotting:
  save_plots: true
  show_plots: false
  format: "png"
  dpi: 300

# ==============================================================================
# LOGGING
# ==============================================================================
logging:
  level: "INFO"
  console_output: true
  file_output: true

# ==============================================================================
# OUTPUT
# ==============================================================================
output:
  directory: "./results"

# ==============================================================================
# USAGE NOTES
# ==============================================================================
#
# QUICK START:
# 1. Update experimental_data.file_path to your data file
# 2. Adjust parameter bounds based on expected shear rates
# 3. Configure phi_filtering for relevant angles
# 4. Run: homodyne --config this_file.yaml --method nlsq
#
# PARAMETER GUIDANCE:
#
# Diffusion Parameters:
# - D₀: Typically 100-10000 for colloidal systems (may be affected by shear)
# - α: May show superdiffusion (α > 0) under strong shear
# - D_offset: Baseline diffusion, may be larger due to shear effects
#
# Shear Parameters:
# - γ̇₀: Shear rate prefactor (1e-6 to 0.5 s⁻¹), depends on applied shear
# - β: Shear evolution exponent (0 for constant shear, ≠0 for time-dependent)
# - γ̇_offset: Baseline shear rate (usually small or zero)
# - φ₀: Flow direction angle (-180° to 180°), typically aligned with measurement
#
# OPTIMIZATION METHODS:
# - nlsq: Fast, deterministic (recommended for initial analysis)
# - mcmc: Slower, provides uncertainties (recommended for publication)
#
# DATASET SIZE HANDLING:
# - < 1M points: Automatic STANDARD strategy
# - 1M-10M: Automatic LARGE strategy
# - 10M-100M: Automatic CHUNKED strategy
# - > 100M: Automatic STREAMING strategy
#
# PARAMETER COUNT:
# - 7 physical parameters (D₀, α, D_offset, γ̇₀, β, γ̇_offset, φ₀)
# - + 2 scaling parameters per filtered phi angle (contrast, offset)
# - Total = 7 + 2 × (number of angles)
# - Example: 3 angles → 7 + 6 = 13 parameters
#
# ANGLE FILTERING:
# - Recommended to filter angles to reduce parameter count
# - Focus on angles parallel and perpendicular to flow for optimal information
# - All angles normalized to [-180°, 180°] with wrap-aware checking
#
# PLATFORM SUPPORT:
# - CPU: Linux, macOS, Windows
# - GPU: Linux only (CUDA 12.1-12.9)
#
# PHYSICAL INTERPRETATION:
# - Shear typically enhances diffusion (larger D₀)
# - Flow may change anomalous exponent α
# - φ₀ should align with known flow direction
# - β ≈ 0 for steady shear, β ≠ 0 for time-dependent shear
#
# ==============================================================================
