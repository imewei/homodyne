

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>homodyne.optimization.classical &mdash; Homodyne Analysis 6.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=66ead900" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=7cffc26f"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980b9" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            Homodyne Analysis
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/modules.html">homodyne</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980b9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Homodyne Analysis</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">homodyne.optimization.classical</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for homodyne.optimization.classical</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Classical Optimization Methods for Homodyne Scattering Analysis</span>
<span class="sd">==============================================================</span>

<span class="sd">This module contains classical optimization algorithms extracted from the</span>
<span class="sd">ConfigurableHomodyneAnalysis class, including:</span>
<span class="sd">- Scipy-based optimization methods (L-BFGS-B, TNC, SLSQP, etc.)</span>
<span class="sd">- Parameter bounds handling</span>
<span class="sd">- Multi-method optimization with fallback strategies</span>
<span class="sd">- Performance tracking and logging</span>

<span class="sd">The classical optimization serves as the first stage in the multi-stage</span>
<span class="sd">optimization pipeline, providing good initial parameter estimates for</span>
<span class="sd">subsequent Bayesian and MCMC methods.</span>

<span class="sd">Authors: Wei Chen, Hongrui He</span>
<span class="sd">Institution: Argonne National Laboratory &amp; University of Chicago</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">optimize</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1"># Global optimization counter for tracking iterations across all methods</span>
<span class="n">OPTIMIZATION_COUNTER</span> <span class="o">=</span> <span class="mi">0</span>


<div class="viewcode-block" id="ClassicalOptimizer">
<a class="viewcode-back" href="../../../api/homodyne.optimization.html#homodyne.ClassicalOptimizer">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ClassicalOptimizer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Classical optimization algorithms for parameter estimation.</span>

<span class="sd">    This class provides robust classical optimization using multiple scipy</span>
<span class="sd">    algorithms with intelligent fallback strategies and parameter bounds</span>
<span class="sd">    handling.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">analysis_core</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize classical optimizer.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        analysis_core : HomodyneAnalysisCore</span>
<span class="sd">            Core analysis engine instance</span>
<span class="sd">        config : Dict[str, Any]</span>
<span class="sd">            Configuration dictionary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">core</span> <span class="o">=</span> <span class="n">analysis_core</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">best_params_classical</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Extract optimization configuration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimization_config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;optimization_config&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;classical_optimization&quot;</span><span class="p">,</span> <span class="p">{}</span>
        <span class="p">)</span>

<div class="viewcode-block" id="ClassicalOptimizer.run_classical_optimization_optimized">
<a class="viewcode-back" href="../../../api/homodyne.optimization.html#homodyne.ClassicalOptimizer.run_classical_optimization_optimized">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">run_classical_optimization_optimized</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">initial_parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">methods</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">phi_angles</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">c2_experimental</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run classical optimization methods.</span>

<span class="sd">        This method systematically tries multiple classical optimization</span>
<span class="sd">        algorithms to find the best parameter estimates. It provides robust</span>
<span class="sd">        optimization with fallback strategies and comprehensive logging.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        initial_parameters : np.ndarray, optional</span>
<span class="sd">            Starting parameters for optimization</span>
<span class="sd">        methods : list, optional</span>
<span class="sd">            List of optimization methods to try</span>
<span class="sd">        phi_angles : np.ndarray, optional</span>
<span class="sd">            Scattering angles</span>
<span class="sd">        c2_experimental : np.ndarray, optional</span>
<span class="sd">            Experimental data</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tuple</span>
<span class="sd">            (best_parameters, optimization_result)</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            If all classical methods fail</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting classical optimization&quot;</span><span class="p">)</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">═══ Classical Optimization ═══&quot;</span><span class="p">)</span>

        <span class="c1"># Determine analysis mode and effective parameter count</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="p">,</span> <span class="s1">&#39;config_manager&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">config_manager</span><span class="p">:</span>
            <span class="n">is_static_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">config_manager</span><span class="o">.</span><span class="n">is_static_mode_enabled</span><span class="p">()</span>
            <span class="n">analysis_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">config_manager</span><span class="o">.</span><span class="n">get_analysis_mode</span><span class="p">()</span>
            <span class="n">effective_param_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">config_manager</span><span class="o">.</span><span class="n">get_effective_parameter_count</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Fallback to core method</span>
            <span class="n">is_static_mode</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="p">,</span> <span class="s1">&#39;is_static_mode&#39;</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="kc">False</span><span class="p">)()</span>
            <span class="n">analysis_mode</span> <span class="o">=</span> <span class="s2">&quot;static&quot;</span> <span class="k">if</span> <span class="n">is_static_mode</span> <span class="k">else</span> <span class="s2">&quot;laminar_flow&quot;</span>
            <span class="n">effective_param_count</span> <span class="o">=</span> <span class="mi">3</span> <span class="k">if</span> <span class="n">is_static_mode</span> <span class="k">else</span> <span class="mi">7</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Analysis mode: </span><span class="si">{</span><span class="n">analysis_mode</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">effective_param_count</span><span class="si">}</span><span class="s2"> parameters)&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Classical optimization using </span><span class="si">{</span><span class="n">analysis_mode</span><span class="si">}</span><span class="s2"> mode with </span><span class="si">{</span><span class="n">effective_param_count</span><span class="si">}</span><span class="s2"> parameters&quot;</span><span class="p">)</span>

        <span class="c1"># Load defaults if not provided</span>
        <span class="k">if</span> <span class="n">methods</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">methods</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimization_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">&quot;methods&quot;</span><span class="p">,</span>
                <span class="p">[</span><span class="s2">&quot;L-BFGS-B&quot;</span><span class="p">,</span> <span class="s2">&quot;TNC&quot;</span><span class="p">,</span> <span class="s2">&quot;SLSQP&quot;</span><span class="p">,</span> <span class="s2">&quot;Powell&quot;</span><span class="p">,</span> <span class="s2">&quot;Nelder-Mead&quot;</span><span class="p">],</span>
            <span class="p">)</span>

        <span class="c1"># Ensure methods is not None for type checker</span>
        <span class="k">assert</span> <span class="n">methods</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Optimization methods list cannot be None&quot;</span>

        <span class="k">if</span> <span class="n">initial_parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">initial_parameters</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;initial_parameters&quot;</span><span class="p">][</span><span class="s2">&quot;values&quot;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span>
            <span class="p">)</span>

        <span class="c1"># Adjust parameters based on analysis mode</span>
        <span class="k">if</span> <span class="n">is_static_mode</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">initial_parameters</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">effective_param_count</span><span class="p">:</span>
            <span class="c1"># For static mode, only use diffusion parameters (first 3)</span>
            <span class="n">initial_parameters</span> <span class="o">=</span> <span class="n">initial_parameters</span><span class="p">[:</span><span class="n">effective_param_count</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Using first </span><span class="si">{</span><span class="n">effective_param_count</span><span class="si">}</span><span class="s2"> parameters for static mode: </span><span class="si">{</span><span class="n">initial_parameters</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">is_static_mode</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">initial_parameters</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">effective_param_count</span><span class="p">:</span>
            <span class="c1"># For laminar flow mode, ensure we have all 7 parameters</span>
            <span class="n">full_parameters</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">effective_param_count</span><span class="p">)</span>
            <span class="n">full_parameters</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">initial_parameters</span><span class="p">)]</span> <span class="o">=</span> <span class="n">initial_parameters</span>
            <span class="n">initial_parameters</span> <span class="o">=</span> <span class="n">full_parameters</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Extended to </span><span class="si">{</span><span class="n">effective_param_count</span><span class="si">}</span><span class="s2"> parameters for laminar flow mode&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">phi_angles</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">c2_experimental</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">c2_experimental</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">phi_angles</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">load_experimental_data</span><span class="p">()</span>

        <span class="c1"># Type assertion after loading data to satisfy type checker</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">phi_angles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">c2_experimental</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">),</span> <span class="s2">&quot;Failed to load experimental data&quot;</span>

        <span class="n">best_result</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">best_params</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">best_chi2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="n">all_results</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Store all results for analysis</span>

        <span class="c1"># Get parameter bounds using utility method (adjusted for mode)</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameter_bounds</span><span class="p">(</span><span class="n">effective_param_count</span><span class="p">,</span> <span class="n">is_static_mode</span><span class="p">)</span>

        <span class="c1"># Create objective function using utility method</span>
        <span class="n">objective</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_objective_function</span><span class="p">(</span>
            <span class="n">phi_angles</span><span class="p">,</span> <span class="n">c2_experimental</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Classical-</span><span class="si">{</span><span class="n">analysis_mode</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Try each method</span>
        <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Trying </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

                <span class="c1"># Use single method utility</span>
                <span class="n">success</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_single_method</span><span class="p">(</span>
                    <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                    <span class="n">objective_func</span><span class="o">=</span><span class="n">objective</span><span class="p">,</span>
                    <span class="n">initial_parameters</span><span class="o">=</span><span class="n">initial_parameters</span><span class="p">,</span>
                    <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="n">bounds</span> <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;L-BFGS-B&quot;</span><span class="p">,</span> <span class="s2">&quot;TNC&quot;</span><span class="p">,</span> <span class="s2">&quot;SLSQP&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span><span class="p">),</span>
                    <span class="n">method_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">optimization_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                        <span class="s2">&quot;method_options&quot;</span><span class="p">,</span> <span class="p">{}</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="p">{}),</span>
                <span class="p">)</span>

                <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>

                <span class="c1"># Store result for analysis</span>
                <span class="k">if</span> <span class="n">success</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">optimize</span><span class="o">.</span><span class="n">OptimizeResult</span><span class="p">):</span>
                    <span class="c1"># Add timing info to result object</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;execution_time&quot;</span><span class="p">,</span> <span class="n">elapsed</span><span class="p">)</span>
                    <span class="n">all_results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">method</span><span class="p">,</span> <span class="n">result</span><span class="p">))</span>

                    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">fun</span> <span class="o">&lt;</span> <span class="n">best_chi2</span><span class="p">:</span>
                        <span class="n">best_result</span> <span class="o">=</span> <span class="n">result</span>
                        <span class="n">best_params</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">x</span>
                        <span class="n">best_chi2</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">fun</span>
                        <span class="nb">print</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;    ✓ New best: χ²_red = </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">fun</span><span class="si">:</span><span class="s2">.6e</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">elapsed</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">s)&quot;</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    χ²_red = </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">fun</span><span class="si">:</span><span class="s2">.6e</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">elapsed</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">s)&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">all_results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">method</span><span class="p">,</span> <span class="n">result</span><span class="p">))</span>  <span class="c1"># Store exception for analysis</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ✗ Failed: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Classical optimization method </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2"> failed: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">all_results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">method</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ✗ Failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Classical optimization method </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2"> failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Full traceback for </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2"> optimization failure:&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="n">best_result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="n">best_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">best_result</span><span class="p">,</span> <span class="n">optimize</span><span class="o">.</span><span class="n">OptimizeResult</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="n">total_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

            <span class="c1"># Generate comprehensive summary (for future use)</span>
            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_optimization_summary</span><span class="p">(</span><span class="n">best_params</span><span class="p">,</span> <span class="n">best_result</span><span class="p">,</span> <span class="n">total_time</span><span class="p">)</span>

            <span class="c1"># Log results</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Classical optimization completed in </span><span class="si">{</span><span class="n">total_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s, best χ²_red = </span><span class="si">{</span><span class="n">best_chi2</span><span class="si">:</span><span class="s2">.6e</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Best result: χ²_red = </span><span class="si">{</span><span class="n">best_chi2</span><span class="si">:</span><span class="s2">.6e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Store best parameters</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">best_params_classical</span> <span class="o">=</span> <span class="n">best_params</span>

            <span class="c1"># Log detailed analysis if debug logging is enabled</span>
            <span class="k">if</span> <span class="n">logger</span><span class="o">.</span><span class="n">isEnabledFor</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">):</span>
                <span class="n">analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_optimization_results</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">method</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">all_results</span>
                        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;fun&quot;</span><span class="p">)</span>
                    <span class="p">]</span>
                <span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Classical optimization analysis: </span><span class="si">{</span><span class="n">analysis</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">best_params</span><span class="p">,</span> <span class="n">best_result</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">total_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

            <span class="c1"># Analyze failed results</span>
            <span class="n">failed_analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_optimization_results</span><span class="p">(</span>
                <span class="p">[(</span><span class="n">method</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span> <span class="k">for</span> <span class="n">method</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">all_results</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Classical optimization failed after </span><span class="si">{</span><span class="n">total_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s - all methods failed&quot;</span>
            <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failure analysis: </span><span class="si">{</span><span class="n">failed_analysis</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;All classical methods failed. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Failed methods: </span><span class="si">{</span><span class="p">[</span><span class="n">method</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">method</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">all_results</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="ClassicalOptimizer.get_available_methods">
<a class="viewcode-back" href="../../../api/homodyne.optimization.html#homodyne.ClassicalOptimizer.get_available_methods">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_available_methods</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get list of available classical optimization methods.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[str]</span>
<span class="sd">            List of available scipy optimization methods</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s2">&quot;L-BFGS-B&quot;</span><span class="p">,</span>  <span class="c1"># Limited-memory BFGS with bounds</span>
            <span class="s2">&quot;TNC&quot;</span><span class="p">,</span>  <span class="c1"># Truncated Newton with bounds</span>
            <span class="s2">&quot;SLSQP&quot;</span><span class="p">,</span>  <span class="c1"># Sequential Least Squares Programming</span>
            <span class="s2">&quot;Powell&quot;</span><span class="p">,</span>  <span class="c1"># Powell&#39;s method</span>
            <span class="s2">&quot;Nelder-Mead&quot;</span><span class="p">,</span>  <span class="c1"># Nelder-Mead simplex</span>
            <span class="s2">&quot;CG&quot;</span><span class="p">,</span>  <span class="c1"># Conjugate gradient</span>
            <span class="s2">&quot;BFGS&quot;</span><span class="p">,</span>  <span class="c1"># BFGS</span>
            <span class="s2">&quot;Newton-CG&quot;</span><span class="p">,</span>  <span class="c1"># Newton conjugate gradient</span>
            <span class="s2">&quot;trust-ncg&quot;</span><span class="p">,</span>  <span class="c1"># Newton conjugate gradient trust-region</span>
            <span class="s2">&quot;trust-exact&quot;</span><span class="p">,</span>  <span class="c1"># Exact trust-region</span>
            <span class="s2">&quot;trust-krylov&quot;</span><span class="p">,</span>  <span class="c1"># Krylov trust-region</span>
        <span class="p">]</span></div>


<div class="viewcode-block" id="ClassicalOptimizer.validate_method_compatibility">
<a class="viewcode-back" href="../../../api/homodyne.optimization.html#homodyne.ClassicalOptimizer.validate_method_compatibility">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_method_compatibility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">has_bounds</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate if optimization method is compatible with current setup.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        method : str</span>
<span class="sd">            Optimization method name</span>
<span class="sd">        has_bounds : bool</span>
<span class="sd">            Whether parameter bounds are defined</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True if method is compatible</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bounds_required_methods</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;L-BFGS-B&quot;</span><span class="p">,</span> <span class="s2">&quot;TNC&quot;</span><span class="p">,</span> <span class="s2">&quot;SLSQP&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">has_bounds</span> <span class="ow">and</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">bounds_required_methods</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">has_bounds</span> <span class="ow">and</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bounds_required_methods</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bounds_required_methods</span></div>


<div class="viewcode-block" id="ClassicalOptimizer.get_method_recommendations">
<a class="viewcode-back" href="../../../api/homodyne.optimization.html#homodyne.ClassicalOptimizer.get_method_recommendations">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_method_recommendations</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get method recommendations based on problem characteristics.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dict[str, List[str]]</span>
<span class="sd">            Dictionary mapping scenarios to lists of recommended methods</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;with_bounds&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;L-BFGS-B&quot;</span><span class="p">,</span> <span class="s2">&quot;TNC&quot;</span><span class="p">,</span> <span class="s2">&quot;SLSQP&quot;</span><span class="p">],</span>
            <span class="s2">&quot;without_bounds&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;BFGS&quot;</span><span class="p">,</span> <span class="s2">&quot;Powell&quot;</span><span class="p">,</span> <span class="s2">&quot;Nelder-Mead&quot;</span><span class="p">],</span>
            <span class="s2">&quot;high_dimensional&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;L-BFGS-B&quot;</span><span class="p">,</span> <span class="s2">&quot;BFGS&quot;</span><span class="p">,</span> <span class="s2">&quot;CG&quot;</span><span class="p">],</span>
            <span class="s2">&quot;low_dimensional&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Nelder-Mead&quot;</span><span class="p">,</span> <span class="s2">&quot;Powell&quot;</span><span class="p">],</span>
            <span class="s2">&quot;noisy_objective&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Powell&quot;</span><span class="p">,</span> <span class="s2">&quot;Nelder-Mead&quot;</span><span class="p">],</span>
            <span class="s2">&quot;smooth_objective&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;L-BFGS-B&quot;</span><span class="p">,</span> <span class="s2">&quot;BFGS&quot;</span><span class="p">,</span> <span class="s2">&quot;Newton-CG&quot;</span><span class="p">],</span>
        <span class="p">}</span></div>


<div class="viewcode-block" id="ClassicalOptimizer.validate_parameters">
<a class="viewcode-back" href="../../../api/homodyne.optimization.html#homodyne.ClassicalOptimizer.validate_parameters">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_parameters</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">method_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate physical parameters and bounds.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        parameters : np.ndarray</span>
<span class="sd">            Model parameters to validate</span>
<span class="sd">        method_name : str</span>
<span class="sd">            Name of optimization method for logging (currently unused)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Tuple[bool, str]</span>
<span class="sd">            (is_valid, reason_if_invalid)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">method_name</span>  <span class="c1"># Suppress unused parameter warning</span>
        <span class="c1"># Get validation configuration</span>
        <span class="n">validation</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;advanced_settings&quot;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;chi_squared_calculation&quot;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;validity_check&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="p">)</span>

        <span class="c1"># Extract parameter sections</span>
        <span class="n">num_diffusion_params</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="p">,</span> <span class="s2">&quot;num_diffusion_params&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">num_shear_params</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="p">,</span> <span class="s2">&quot;num_shear_rate_params&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

        <span class="n">diffusion_params</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[:</span><span class="n">num_diffusion_params</span><span class="p">]</span>
        <span class="n">shear_params</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span>
            <span class="n">num_diffusion_params</span> <span class="p">:</span> <span class="n">num_diffusion_params</span> <span class="o">+</span> <span class="n">num_shear_params</span>
        <span class="p">]</span>

        <span class="c1"># Check positive D0</span>
        <span class="k">if</span> <span class="n">validation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;check_positive_D0&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span> <span class="ow">and</span> <span class="n">diffusion_params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Negative D0: </span><span class="si">{</span><span class="n">diffusion_params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Check positive gamma_dot_t0</span>
        <span class="k">if</span> <span class="n">validation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;check_positive_gamma_dot_t0&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span> <span class="ow">and</span> <span class="n">shear_params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Negative gamma_dot_t0: </span><span class="si">{</span><span class="n">shear_params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Check parameter bounds</span>
        <span class="k">if</span> <span class="n">validation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;check_parameter_bounds&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;parameter_space&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bounds&quot;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">bound</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bounds</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">):</span>
                    <span class="n">param_val</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">param_min</span> <span class="o">=</span> <span class="n">bound</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
                    <span class="n">param_max</span> <span class="o">=</span> <span class="n">bound</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;max&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">param_min</span> <span class="o">&lt;=</span> <span class="n">param_val</span> <span class="o">&lt;=</span> <span class="n">param_max</span><span class="p">):</span>
                        <span class="n">param_name</span> <span class="o">=</span> <span class="n">bound</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;p</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">return</span> <span class="p">(</span>
                            <span class="kc">False</span><span class="p">,</span>
                            <span class="sa">f</span><span class="s2">&quot;Parameter </span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2"> out of bounds: </span><span class="si">{</span><span class="n">param_val</span><span class="si">}</span><span class="s2"> not in [</span><span class="si">{</span><span class="n">param_min</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">param_max</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">,</span>
                        <span class="p">)</span>

        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;&quot;</span></div>


<div class="viewcode-block" id="ClassicalOptimizer.create_objective_function">
<a class="viewcode-back" href="../../../api/homodyne.optimization.html#homodyne.ClassicalOptimizer.create_objective_function">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_objective_function</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">phi_angles</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">c2_experimental</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">method_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Classical&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create objective function for optimization.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        phi_angles : np.ndarray</span>
<span class="sd">            Scattering angles</span>
<span class="sd">        c2_experimental : np.ndarray</span>
<span class="sd">            Experimental correlation data</span>
<span class="sd">        method_name : str</span>
<span class="sd">            Name for logging purposes</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        callable</span>
<span class="sd">            Objective function for optimization</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get angle filtering setting from configuration</span>
        <span class="n">use_angle_filtering</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="p">,</span> <span class="s2">&quot;config_manager&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">config_manager</span><span class="p">:</span>
            <span class="n">use_angle_filtering</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">config_manager</span><span class="o">.</span><span class="n">is_angle_filtering_enabled</span><span class="p">()</span>
        <span class="k">elif</span> <span class="s2">&quot;angle_filtering&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;optimization_config&quot;</span><span class="p">,</span> <span class="p">{}):</span>
            <span class="n">use_angle_filtering</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;optimization_config&quot;</span><span class="p">][</span>
                <span class="s2">&quot;angle_filtering&quot;</span>
            <span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;enabled&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">objective</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">calculate_chi_squared_optimized</span><span class="p">(</span>
                <span class="n">params</span><span class="p">,</span>
                <span class="n">phi_angles</span><span class="p">,</span>
                <span class="n">c2_experimental</span><span class="p">,</span>
                <span class="n">method_name</span><span class="p">,</span>
                <span class="n">filter_angles_for_optimization</span><span class="o">=</span><span class="n">use_angle_filtering</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">objective</span></div>


<div class="viewcode-block" id="ClassicalOptimizer.run_single_method">
<a class="viewcode-back" href="../../../api/homodyne.optimization.html#homodyne.ClassicalOptimizer.run_single_method">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">run_single_method</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">objective_func</span><span class="p">,</span>
        <span class="n">initial_parameters</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">bounds</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">method_options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">optimize</span><span class="o">.</span><span class="n">OptimizeResult</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run a single optimization method.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        method : str</span>
<span class="sd">            Optimization method name</span>
<span class="sd">        objective_func : callable</span>
<span class="sd">            Objective function to minimize</span>
<span class="sd">        initial_parameters : np.ndarray</span>
<span class="sd">            Starting parameters</span>
<span class="sd">        bounds : List[Tuple[float, float]], optional</span>
<span class="sd">            Parameter bounds</span>
<span class="sd">        method_options : Dict[str, Any], optional</span>
<span class="sd">            Method-specific options</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Tuple[bool, Union[OptimizeResult, Exception]]</span>
<span class="sd">            (success, result_or_exception)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Filter out comment fields (keys starting with &#39;_&#39; and ending with &#39;_note&#39;)</span>
            <span class="n">filtered_options</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">method_options</span><span class="p">:</span>
                <span class="n">filtered_options</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="n">k</span><span class="p">:</span> <span class="n">v</span>
                    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">method_options</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">k</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_note&quot;</span><span class="p">))</span>
                <span class="p">}</span>

            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;fun&quot;</span><span class="p">:</span> <span class="n">objective_func</span><span class="p">,</span>
                <span class="s2">&quot;x0&quot;</span><span class="p">:</span> <span class="n">initial_parameters</span><span class="p">,</span>
                <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span>
                <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="n">filtered_options</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="c1"># Add bounds for methods that support them</span>
            <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;L-BFGS-B&quot;</span><span class="p">,</span> <span class="s2">&quot;TNC&quot;</span><span class="p">,</span> <span class="s2">&quot;SLSQP&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">bounds</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;bounds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bounds</span>

            <span class="n">result</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">result</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">e</span></div>


<div class="viewcode-block" id="ClassicalOptimizer.analyze_optimization_results">
<a class="viewcode-back" href="../../../api/homodyne.optimization.html#homodyne.ClassicalOptimizer.analyze_optimization_results">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">analyze_optimization_results</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">optimize</span><span class="o">.</span><span class="n">OptimizeResult</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">]]],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Analyze and summarize optimization results from multiple methods.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        results : List[Tuple[str, bool, Union[OptimizeResult, Exception]]]</span>
<span class="sd">            List of (method_name, success, result_or_exception) tuples</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dict[str, Any]</span>
<span class="sd">            Analysis summary including best method, convergence stats, etc.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">successful_results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">failed_methods</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">method</span><span class="p">,</span> <span class="n">success</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">success</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;fun&quot;</span><span class="p">):</span>
                <span class="n">successful_results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">method</span><span class="p">,</span> <span class="n">result</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">failed_methods</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">method</span><span class="p">,</span> <span class="n">result</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">successful_results</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;failed_methods&quot;</span><span class="p">:</span> <span class="n">failed_methods</span><span class="p">,</span>
                <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;All methods failed&quot;</span><span class="p">,</span>
            <span class="p">}</span>

        <span class="c1"># Find best result</span>
        <span class="n">best_method</span><span class="p">,</span> <span class="n">best_result</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">successful_results</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fun</span><span class="p">)</span>

        <span class="c1"># Compute statistics</span>
        <span class="n">chi2_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">fun</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">successful_results</span><span class="p">]</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;best_method&quot;</span><span class="p">:</span> <span class="n">best_method</span><span class="p">,</span>
            <span class="s2">&quot;best_result&quot;</span><span class="p">:</span> <span class="n">best_result</span><span class="p">,</span>
            <span class="s2">&quot;best_chi2&quot;</span><span class="p">:</span> <span class="n">best_result</span><span class="o">.</span><span class="n">fun</span><span class="p">,</span>
            <span class="s2">&quot;successful_methods&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">successful_results</span><span class="p">),</span>
            <span class="s2">&quot;failed_methods&quot;</span><span class="p">:</span> <span class="n">failed_methods</span><span class="p">,</span>
            <span class="s2">&quot;chi2_statistics&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">chi2_values</span><span class="p">),</span>
                <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">chi2_values</span><span class="p">),</span>
                <span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">chi2_values</span><span class="p">),</span>
                <span class="s2">&quot;std&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">chi2_values</span><span class="p">),</span>
            <span class="p">},</span>
            <span class="s2">&quot;convergence_info&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="n">method</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">,</span>
                    <span class="s2">&quot;iterations&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;nit&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                    <span class="s2">&quot;function_evaluations&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;nfev&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                    <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="n">method</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">successful_results</span>
            <span class="p">},</span>
        <span class="p">}</span></div>


<div class="viewcode-block" id="ClassicalOptimizer.get_parameter_bounds">
<a class="viewcode-back" href="../../../api/homodyne.optimization.html#homodyne.ClassicalOptimizer.get_parameter_bounds">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_parameter_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">effective_param_count</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">is_static_mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract parameter bounds from configuration, adjusted for analysis mode.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        effective_param_count : int, optional</span>
<span class="sd">            Number of parameters to use (3 for static, 7 for laminar flow)</span>
<span class="sd">        is_static_mode : bool, optional</span>
<span class="sd">            Whether static mode is enabled</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[Tuple[float, float]]</span>
<span class="sd">            List of (min, max) bounds for each parameter</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">param_bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;parameter_space&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bounds&quot;</span><span class="p">,</span> <span class="p">[])</span>
        
        <span class="c1"># Determine effective parameter count if not provided</span>
        <span class="k">if</span> <span class="n">effective_param_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="p">,</span> <span class="s1">&#39;config_manager&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">config_manager</span><span class="p">:</span>
                <span class="n">effective_param_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">config_manager</span><span class="o">.</span><span class="n">get_effective_parameter_count</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">effective_param_count</span> <span class="o">=</span> <span class="mi">7</span>  <span class="c1"># Default to laminar flow</span>
        
        <span class="c1"># Ensure effective_param_count is not None for type checking</span>
        <span class="k">if</span> <span class="n">effective_param_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">effective_param_count</span> <span class="o">=</span> <span class="mi">7</span>  <span class="c1"># Final fallback to laminar flow</span>
        
        <span class="c1"># Extract bounds for the effective parameters</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">bound</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">param_bounds</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">effective_param_count</span><span class="p">:</span>
                <span class="n">bounds</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">bound</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="n">bound</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;max&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)))</span>
        
        <span class="c1"># Ensure we have enough bounds</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">effective_param_count</span><span class="p">:</span>
            <span class="n">bounds</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">))</span>
            
        <span class="k">return</span> <span class="n">bounds</span><span class="p">[:</span><span class="n">effective_param_count</span><span class="p">]</span></div>


<div class="viewcode-block" id="ClassicalOptimizer.compare_optimization_results">
<a class="viewcode-back" href="../../../api/homodyne.optimization.html#homodyne.ClassicalOptimizer.compare_optimization_results">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">compare_optimization_results</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">optimize</span><span class="o">.</span><span class="n">OptimizeResult</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">]]],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compare optimization results from different methods.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        results : List[Tuple[str, Union[OptimizeResult, Exception]]]</span>
<span class="sd">            List of (method_name, result) tuples</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dict[str, Any]</span>
<span class="sd">            Comparison summary with rankings and statistics</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">successful_results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">failed_methods</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">method</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">optimize</span><span class="o">.</span><span class="n">OptimizeResult</span><span class="p">)</span> <span class="ow">and</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
                <span class="n">successful_results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">method</span><span class="p">,</span> <span class="n">result</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">failed_methods</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">successful_results</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;No successful optimizations to compare&quot;</span><span class="p">}</span>

        <span class="c1"># Sort by chi-squared value</span>
        <span class="n">successful_results</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fun</span><span class="p">)</span>

        <span class="n">comparison</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;ranking&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;rank&quot;</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span>
                    <span class="s2">&quot;chi_squared&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">fun</span><span class="p">,</span>
                    <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">,</span>
                    <span class="s2">&quot;iterations&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;nit&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                    <span class="s2">&quot;function_evaluations&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;nfev&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                    <span class="s2">&quot;time_elapsed&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;execution_time&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">successful_results</span><span class="p">)</span>
            <span class="p">],</span>
            <span class="s2">&quot;best_method&quot;</span><span class="p">:</span> <span class="n">successful_results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
            <span class="s2">&quot;best_chi_squared&quot;</span><span class="p">:</span> <span class="n">successful_results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fun</span><span class="p">,</span>
            <span class="s2">&quot;failed_methods&quot;</span><span class="p">:</span> <span class="n">failed_methods</span><span class="p">,</span>
            <span class="s2">&quot;success_rate&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">successful_results</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">comparison</span></div>


<div class="viewcode-block" id="ClassicalOptimizer.get_optimization_summary">
<a class="viewcode-back" href="../../../api/homodyne.optimization.html#homodyne.ClassicalOptimizer.get_optimization_summary">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_optimization_summary</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">best_params</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">best_result</span><span class="p">:</span> <span class="n">optimize</span><span class="o">.</span><span class="n">OptimizeResult</span><span class="p">,</span>
        <span class="n">total_time</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate comprehensive optimization summary.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        best_params : np.ndarray</span>
<span class="sd">            Best parameters found</span>
<span class="sd">        best_result : OptimizeResult</span>
<span class="sd">            Best optimization result</span>
<span class="sd">        total_time : float</span>
<span class="sd">            Total optimization time in seconds</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dict[str, Any]</span>
<span class="sd">            Comprehensive optimization summary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Parameter names (if available in config)</span>
        <span class="n">param_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">param_bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;parameter_space&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bounds&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">bound</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">param_bounds</span><span class="p">):</span>
            <span class="n">param_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bound</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;param_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>

        <span class="n">summary</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;optimization_successful&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;best_chi_squared&quot;</span><span class="p">:</span> <span class="n">best_result</span><span class="o">.</span><span class="n">fun</span><span class="p">,</span>
            <span class="s2">&quot;best_parameters&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="p">(</span><span class="n">param_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_names</span><span class="p">)</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;param_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span> <span class="nb">float</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">best_params</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="s2">&quot;optimization_details&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">best_result</span><span class="p">,</span> <span class="s2">&quot;method&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">),</span>
                <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="n">best_result</span><span class="o">.</span><span class="n">success</span><span class="p">,</span>
                <span class="s2">&quot;iterations&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">best_result</span><span class="p">,</span> <span class="s2">&quot;nit&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                <span class="s2">&quot;function_evaluations&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">best_result</span><span class="p">,</span> <span class="s2">&quot;nfev&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">best_result</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="p">},</span>
            <span class="s2">&quot;timing&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;total_time_seconds&quot;</span><span class="p">:</span> <span class="n">total_time</span><span class="p">,</span>
                <span class="s2">&quot;average_evaluation_time&quot;</span><span class="p">:</span> <span class="p">(</span>
                    <span class="n">total_time</span> <span class="o">/</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">best_result</span><span class="p">,</span> <span class="s2">&quot;nfev&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="p">),</span>
            <span class="p">},</span>
            <span class="s2">&quot;parameter_validation&quot;</span><span class="p">:</span> <span class="p">{},</span>
        <span class="p">}</span>

        <span class="c1"># Add parameter validation info</span>
        <span class="n">is_valid</span><span class="p">,</span> <span class="n">reason</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_parameters</span><span class="p">(</span><span class="n">best_params</span><span class="p">,</span> <span class="s2">&quot;Summary&quot;</span><span class="p">)</span>
        <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;parameter_validation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;valid&quot;</span><span class="p">:</span> <span class="n">is_valid</span><span class="p">,</span>
            <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">reason</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">is_valid</span> <span class="k">else</span> <span class="s2">&quot;All parameters within bounds&quot;</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">summary</span></div>


<div class="viewcode-block" id="ClassicalOptimizer.reset_optimization_counter">
<a class="viewcode-back" href="../../../api/homodyne.optimization.html#homodyne.ClassicalOptimizer.reset_optimization_counter">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">reset_optimization_counter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reset the global optimization counter.&quot;&quot;&quot;</span>
        <span class="k">global</span> <span class="n">OPTIMIZATION_COUNTER</span>
        <span class="n">OPTIMIZATION_COUNTER</span> <span class="o">=</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="ClassicalOptimizer.get_optimization_counter">
<a class="viewcode-back" href="../../../api/homodyne.optimization.html#homodyne.ClassicalOptimizer.get_optimization_counter">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_optimization_counter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get current optimization counter value.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">OPTIMIZATION_COUNTER</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Wei Chen, Hongrui He.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>