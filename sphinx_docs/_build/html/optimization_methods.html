

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Optimization Methods &mdash; Homodyne Analysis 6.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/custom.css?v=66ead900" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=54d05895"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Scaling Optimization" href="scaling_optimization.html" />
    <link rel="prev" title="Configuration System" href="configuration.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980b9" >

          
          
          <a href="index.html" class="icon icon-home">
            Homodyne Analysis
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick Start Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="analysis_modes.html">Analysis Modes</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration System</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced Topics</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Optimization Methods</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#method-overview">Method Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#classical-optimization">Classical Optimization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#algorithm-details">Algorithm Details</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mathematical-formulation">Mathematical Formulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#always-on-scaling-optimization">Always-On Scaling Optimization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#usage-examples">Usage Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="#performance-characteristics">Performance Characteristics</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#bayesian-mcmc-sampling">Bayesian MCMC Sampling</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Algorithm Details</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bayesian-formulation">Bayesian Formulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#prior-distributions">Prior Distributions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">Usage Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="#output-analysis">Output Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">Performance Characteristics</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#combined-analysis-workflow">Combined Analysis Workflow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#recommended-strategy">Recommended Strategy</a></li>
<li class="toctree-l3"><a class="reference internal" href="#benefits-of-combined-approach">Benefits of Combined Approach</a></li>
<li class="toctree-l3"><a class="reference internal" href="#implementation-example">Implementation Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#method-selection-guidelines">Method Selection Guidelines</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#choose-classical-when">Choose Classical When</a></li>
<li class="toctree-l3"><a class="reference internal" href="#choose-mcmc-when">Choose MCMC When</a></li>
<li class="toctree-l3"><a class="reference internal" href="#choose-combined-when">Choose Combined When</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#troubleshooting-optimization">Troubleshooting Optimization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#classical-optimization-issues">Classical Optimization Issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mcmc-issues">MCMC Issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#performance-optimization">Performance Optimization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id5">Classical Optimization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mcmc-sampling">MCMC Sampling</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#validation-and-quality-assurance">Validation and Quality Assurance</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#result-validation">Result Validation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cross-validation">Cross-Validation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="scaling_optimization.html">Scaling Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="performance.html">Performance Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_validation.html">Data Validation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api/modules.html">homodyne</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Testing and Quality Assurance</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="migration_guide.html">Migration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing Guide</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980b9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Homodyne Analysis</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Optimization Methods</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="optimization-methods">
<h1>Optimization Methods<a class="headerlink" href="#optimization-methods" title="Link to this heading"></a></h1>
<p>The homodyne package provides two complementary optimization approaches: fast classical optimization for point estimates and robust Bayesian MCMC sampling for full posterior distributions with uncertainty quantification.</p>
<section id="method-overview">
<h2>Method Overview<a class="headerlink" href="#method-overview" title="Link to this heading"></a></h2>
<table class="docutils align-default" id="id6">
<caption><span class="caption-text">Optimization Method Comparison</span><a class="headerlink" href="#id6" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 20.0%" />
<col style="width: 20.0%" />
<col style="width: 20.0%" />
<col style="width: 40.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Method</p></th>
<th class="head"><p>Performance</p></th>
<th class="head"><p>Output Type</p></th>
<th class="head"><p>Best Use Case</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Classical</strong></p></td>
<td><p>Fast (~minutes)</p></td>
<td><p>Point estimates</p></td>
<td><p>Exploratory analysis, parameter screening</p></td>
</tr>
<tr class="row-odd"><td><p><strong>MCMC</strong></p></td>
<td><p>Comprehensive (~hours)</p></td>
<td><p>Full posteriors</p></td>
<td><p>Uncertainty quantification, robust estimates</p></td>
</tr>
<tr class="row-even"><td><p><strong>Combined</strong></p></td>
<td><p>Sequential</p></td>
<td><p>Both</p></td>
<td><p>Recommended workflow</p></td>
</tr>
</tbody>
</table>
</section>
<section id="classical-optimization">
<h2>Classical Optimization<a class="headerlink" href="#classical-optimization" title="Link to this heading"></a></h2>
<section id="algorithm-details">
<h3>Algorithm Details<a class="headerlink" href="#algorithm-details" title="Link to this heading"></a></h3>
<p>The classical optimization uses the <strong>Nelder-Mead simplex method</strong> via SciPy, which is well-suited for the complex, multi-modal optimization landscapes typical in correlation function fitting.</p>
<p><strong>Key Features</strong>:
- Derivative-free optimization
- Robust to local minima
- Handles parameter bounds effectively
- Fast execution for most parameter spaces</p>
</section>
<section id="mathematical-formulation">
<h3>Mathematical Formulation<a class="headerlink" href="#mathematical-formulation" title="Link to this heading"></a></h3>
<p>The objective function minimizes the chi-squared statistic:</p>
<div class="math notranslate nohighlight">
\[\chi^2(\mathbf{p}) = \sum_i \frac{[g_{2,\text{exp}}(i) - g_{2,\text{theory}}(i, \mathbf{p})]^2}{\sigma_i^2}\]</div>
<p>where:
- <span class="math notranslate nohighlight">\(\mathbf{p}\)</span> is the parameter vector
- <span class="math notranslate nohighlight">\(g_{2,\text{exp}}\)</span> is the experimental correlation function
- <span class="math notranslate nohighlight">\(g_{2,\text{theory}}\)</span> is the theoretical model
- <span class="math notranslate nohighlight">\(\sigma_i\)</span> are the experimental uncertainties</p>
</section>
<section id="always-on-scaling-optimization">
<h3>Always-On Scaling Optimization<a class="headerlink" href="#always-on-scaling-optimization" title="Link to this heading"></a></h3>
<p><strong>Scaling optimization is automatically enabled</strong> for scientifically accurate results. The relationship between experimental and theoretical correlation functions is:</p>
<div class="math notranslate nohighlight">
\[g_2 = \text{offset} + \text{contrast} \times g_1\]</div>
<p>The optimal scaling parameters are determined using least squares:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">theory</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">theory</span><span class="p">))])</span><span class="o">.</span><span class="n">T</span>
<span class="n">scaling</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">experimental</span><span class="p">,</span> <span class="n">rcond</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">contrast</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">scaling</span>
</pre></div>
</div>
</section>
<section id="configuration">
<h3>Configuration<a class="headerlink" href="#configuration" title="Link to this heading"></a></h3>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;optimization&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;method&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Nelder-Mead&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;max_iterations&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10000</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;tolerance&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">1e-8</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;initial_simplex_size&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.1</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Parameters</strong>:
- <strong>method</strong>: Optimization algorithm (Nelder-Mead recommended)
- <strong>max_iterations</strong>: Maximum number of optimization steps
- <strong>tolerance</strong>: Convergence tolerance for parameter changes
- <strong>initial_simplex_size</strong>: Initial simplex size relative to parameter values</p>
</section>
<section id="usage-examples">
<h3>Usage Examples<a class="headerlink" href="#usage-examples" title="Link to this heading"></a></h3>
<p><strong>Command Line</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Basic classical optimization</span>
python<span class="w"> </span>run_homodyne.py<span class="w"> </span>--static-isotropic<span class="w"> </span>--method<span class="w"> </span>classical

<span class="c1"># With specific configuration</span>
python<span class="w"> </span>run_homodyne.py<span class="w"> </span>--config<span class="w"> </span>my_config.json<span class="w"> </span>--method<span class="w"> </span>classical
</pre></div>
</div>
<p><strong>Python API</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">homodyne</span><span class="w"> </span><span class="kn">import</span> <span class="n">HomodyneAnalysisCore</span><span class="p">,</span> <span class="n">ConfigManager</span>

<span class="n">config</span> <span class="o">=</span> <span class="n">ConfigManager</span><span class="p">(</span><span class="s2">&quot;my_config.json&quot;</span><span class="p">)</span>
<span class="n">analysis</span> <span class="o">=</span> <span class="n">HomodyneAnalysisCore</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

<span class="c1"># Run classical optimization</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">optimize_classical</span><span class="p">()</span>

<span class="c1"># Access results</span>
<span class="n">optimized_params</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">x</span>
<span class="n">chi_squared</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">fun</span>
<span class="n">success</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">success</span>
<span class="n">iterations</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">nit</span>
</pre></div>
</div>
</section>
<section id="performance-characteristics">
<h3>Performance Characteristics<a class="headerlink" href="#performance-characteristics" title="Link to this heading"></a></h3>
<p><strong>Speed</strong>: Typically completes in minutes for most datasets
<strong>Memory</strong>: Low memory footprint
<strong>Scalability</strong>: Performance scales well with parameter count
<strong>Reliability</strong>: Robust convergence for well-posed problems</p>
</section>
</section>
<section id="bayesian-mcmc-sampling">
<h2>Bayesian MCMC Sampling<a class="headerlink" href="#bayesian-mcmc-sampling" title="Link to this heading"></a></h2>
<section id="id1">
<h3>Algorithm Details<a class="headerlink" href="#id1" title="Link to this heading"></a></h3>
<p>The package uses <strong>PyMC</strong> with the <strong>NUTS (No-U-Turn Sampler)</strong> algorithm, which provides:</p>
<ul class="simple">
<li><p>Efficient exploration of posterior distributions</p></li>
<li><p>Automatic step size adaptation</p></li>
<li><p>Geometric convergence properties</p></li>
<li><p>Robust handling of parameter correlations</p></li>
</ul>
<p><strong>Key Features</strong>:
- Full posterior distributions
- Uncertainty quantification
- Convergence diagnostics
- Parameter correlation analysis</p>
</section>
<section id="bayesian-formulation">
<h3>Bayesian Formulation<a class="headerlink" href="#bayesian-formulation" title="Link to this heading"></a></h3>
<p>The Bayesian approach treats parameters as random variables with prior distributions and computes the posterior:</p>
<div class="math notranslate nohighlight">
\[P(\mathbf{p}|\mathbf{d}) \propto P(\mathbf{d}|\mathbf{p}) \times P(\mathbf{p})\]</div>
<p>where:
- <span class="math notranslate nohighlight">\(P(\mathbf{p}|\mathbf{d})\)</span> is the posterior distribution
- <span class="math notranslate nohighlight">\(P(\mathbf{d}|\mathbf{p})\)</span> is the likelihood function
- <span class="math notranslate nohighlight">\(P(\mathbf{p})\)</span> is the prior distribution</p>
</section>
<section id="prior-distributions">
<h3>Prior Distributions<a class="headerlink" href="#prior-distributions" title="Link to this heading"></a></h3>
<p>The package uses weakly informative priors based on physical constraints:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example prior setup</span>
<span class="n">D0</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="s2">&quot;D0&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mf">1e-15</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">1e-9</span><span class="p">)</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
<span class="n">D_offset</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="s2">&quot;D_offset&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">1e-11</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id2">
<h3>Configuration<a class="headerlink" href="#id2" title="Link to this heading"></a></h3>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;mcmc&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;n_samples&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2000</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;tune&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;chains&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;target_accept&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.8</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;random_seed&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;cores&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Parameters</strong>:
- <strong>n_samples</strong>: Number of posterior samples per chain
- <strong>tune</strong>: Number of tuning steps for sampler adaptation
- <strong>chains</strong>: Number of parallel MCMC chains
- <strong>target_accept</strong>: Target acceptance rate (0.8-0.95 recommended)
- <strong>random_seed</strong>: Random seed for reproducibility
- <strong>cores</strong>: Number of CPU cores for parallel sampling</p>
</section>
<section id="id3">
<h3>Usage Examples<a class="headerlink" href="#id3" title="Link to this heading"></a></h3>
<p><strong>Command Line</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Basic MCMC sampling</span>
python<span class="w"> </span>run_homodyne.py<span class="w"> </span>--static-isotropic<span class="w"> </span>--method<span class="w"> </span>mcmc

<span class="c1"># Flow analysis with MCMC</span>
python<span class="w"> </span>run_homodyne.py<span class="w"> </span>--laminar-flow<span class="w"> </span>--method<span class="w"> </span>mcmc
</pre></div>
</div>
<p><strong>Python API</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">homodyne</span><span class="w"> </span><span class="kn">import</span> <span class="n">HomodyneAnalysisCore</span><span class="p">,</span> <span class="n">ConfigManager</span>

<span class="n">config</span> <span class="o">=</span> <span class="n">ConfigManager</span><span class="p">(</span><span class="s2">&quot;my_config.json&quot;</span><span class="p">)</span>
<span class="n">analysis</span> <span class="o">=</span> <span class="n">HomodyneAnalysisCore</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

<span class="c1"># Run MCMC sampling</span>
<span class="n">mcmc_results</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">optimize_mcmc</span><span class="p">()</span>

<span class="c1"># Access posterior samples</span>
<span class="n">posterior</span> <span class="o">=</span> <span class="n">mcmc_results</span><span class="o">.</span><span class="n">posterior</span>
<span class="n">parameter_means</span> <span class="o">=</span> <span class="n">posterior</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">parameter_stds</span> <span class="o">=</span> <span class="n">posterior</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

<span class="c1"># Convergence diagnostics</span>
<span class="n">r_hat</span> <span class="o">=</span> <span class="n">mcmc_results</span><span class="o">.</span><span class="n">r_hat</span>  <span class="c1"># Should be &lt; 1.1</span>
<span class="n">ess</span> <span class="o">=</span> <span class="n">mcmc_results</span><span class="o">.</span><span class="n">effective_sample_size</span>
</pre></div>
</div>
</section>
<section id="output-analysis">
<h3>Output Analysis<a class="headerlink" href="#output-analysis" title="Link to this heading"></a></h3>
<p><strong>Posterior Summary</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">arviz</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">az</span>

<span class="c1"># Summary statistics</span>
<span class="n">summary</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">mcmc_results</span><span class="o">.</span><span class="n">idata</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>

<span class="c1"># Corner plot for parameter correlations</span>
<span class="n">az</span><span class="o">.</span><span class="n">plot_pair</span><span class="p">(</span><span class="n">mcmc_results</span><span class="o">.</span><span class="n">idata</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="n">active_parameters</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Convergence Diagnostics</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># R-hat convergence diagnostic (should be &lt; 1.1)</span>
<span class="n">r_hat</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">rhat</span><span class="p">(</span><span class="n">mcmc_results</span><span class="o">.</span><span class="n">idata</span><span class="p">)</span>

<span class="c1"># Effective sample size</span>
<span class="n">ess</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">ess</span><span class="p">(</span><span class="n">mcmc_results</span><span class="o">.</span><span class="n">idata</span><span class="p">)</span>

<span class="c1"># Trace plots</span>
<span class="n">az</span><span class="o">.</span><span class="n">plot_trace</span><span class="p">(</span><span class="n">mcmc_results</span><span class="o">.</span><span class="n">idata</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id4">
<h3>Performance Characteristics<a class="headerlink" href="#id4" title="Link to this heading"></a></h3>
<p><strong>Speed</strong>: Typically requires hours for comprehensive analysis
<strong>Memory</strong>: Higher memory requirements for large datasets
<strong>Scalability</strong>: Performance scales with parameter count and complexity
<strong>Quality</strong>: Provides robust uncertainty quantification</p>
</section>
</section>
<section id="combined-analysis-workflow">
<h2>Combined Analysis Workflow<a class="headerlink" href="#combined-analysis-workflow" title="Link to this heading"></a></h2>
<section id="recommended-strategy">
<h3>Recommended Strategy<a class="headerlink" href="#recommended-strategy" title="Link to this heading"></a></h3>
<p>The most effective approach combines both methods sequentially:</p>
<ol class="arabic simple">
<li><p><strong>Classical optimization</strong> for initial parameter estimates</p></li>
<li><p><strong>MCMC sampling</strong> using classical results as starting points</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Combined analysis</span>
python<span class="w"> </span>run_homodyne.py<span class="w"> </span>--static-anisotropic<span class="w"> </span>--method<span class="w"> </span>all
</pre></div>
</div>
</section>
<section id="benefits-of-combined-approach">
<h3>Benefits of Combined Approach<a class="headerlink" href="#benefits-of-combined-approach" title="Link to this heading"></a></h3>
<p><strong>Efficiency</strong>:
- Classical optimization provides good starting points
- Reduces MCMC burn-in time
- Improves sampling efficiency</p>
<p><strong>Robustness</strong>:
- Classical optimization explores parameter space quickly
- MCMC provides thorough uncertainty analysis
- Combined results validate each other</p>
<p><strong>Scientific Rigor</strong>:
- Point estimates for parameter interpretation
- Full posteriors for uncertainty quantification
- Comprehensive characterization of parameter space</p>
</section>
<section id="implementation-example">
<h3>Implementation Example<a class="headerlink" href="#implementation-example" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">homodyne</span><span class="w"> </span><span class="kn">import</span> <span class="n">HomodyneAnalysisCore</span><span class="p">,</span> <span class="n">ConfigManager</span>

<span class="n">config</span> <span class="o">=</span> <span class="n">ConfigManager</span><span class="p">(</span><span class="s2">&quot;my_config.json&quot;</span><span class="p">)</span>
<span class="n">analysis</span> <span class="o">=</span> <span class="n">HomodyneAnalysisCore</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

<span class="c1"># Step 1: Classical optimization</span>
<span class="n">classical_results</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">optimize_classical</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Classical chi-squared: </span><span class="si">{</span><span class="n">classical_results</span><span class="o">.</span><span class="n">fun</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Step 2: Use classical results to initialize MCMC</span>
<span class="n">config</span><span class="o">.</span><span class="n">override_parameters</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span>
    <span class="n">config</span><span class="o">.</span><span class="n">get_active_parameters</span><span class="p">(),</span>
    <span class="n">classical_results</span><span class="o">.</span><span class="n">x</span>
<span class="p">)))</span>

<span class="c1"># Step 3: MCMC sampling</span>
<span class="n">mcmc_results</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">optimize_mcmc</span><span class="p">()</span>

<span class="c1"># Step 4: Compare results</span>
<span class="n">classical_params</span> <span class="o">=</span> <span class="n">classical_results</span><span class="o">.</span><span class="n">x</span>
<span class="n">mcmc_means</span> <span class="o">=</span> <span class="n">mcmc_results</span><span class="o">.</span><span class="n">posterior</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">mcmc_stds</span> <span class="o">=</span> <span class="n">mcmc_results</span><span class="o">.</span><span class="n">posterior</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="method-selection-guidelines">
<h2>Method Selection Guidelines<a class="headerlink" href="#method-selection-guidelines" title="Link to this heading"></a></h2>
<section id="choose-classical-when">
<h3>Choose Classical When<a class="headerlink" href="#choose-classical-when" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Exploratory analysis</strong>: Quick parameter estimation</p></li>
<li><p><strong>Parameter screening</strong>: Testing multiple configurations</p></li>
<li><p><strong>Computational constraints</strong>: Limited time or resources</p></li>
<li><p><strong>Initial validation</strong>: Checking model feasibility</p></li>
</ul>
</section>
<section id="choose-mcmc-when">
<h3>Choose MCMC When<a class="headerlink" href="#choose-mcmc-when" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Publication-quality results</strong>: Need uncertainty quantification</p></li>
<li><p><strong>Parameter correlations</strong>: Understanding parameter relationships</p></li>
<li><p><strong>Robust estimation</strong>: Want comprehensive parameter characterization</p></li>
<li><p><strong>Scientific rigor</strong>: Full Bayesian inference required</p></li>
</ul>
</section>
<section id="choose-combined-when">
<h3>Choose Combined When<a class="headerlink" href="#choose-combined-when" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Complete analysis</strong>: Both point estimates and uncertainties needed</p></li>
<li><p><strong>Complex parameter spaces</strong>: Potential multimodality or correlations</p></li>
<li><p><strong>Research projects</strong>: Comprehensive characterization required</p></li>
<li><p><strong>Validation studies</strong>: Cross-validation of methods</p></li>
</ul>
</section>
</section>
<section id="troubleshooting-optimization">
<h2>Troubleshooting Optimization<a class="headerlink" href="#troubleshooting-optimization" title="Link to this heading"></a></h2>
<section id="classical-optimization-issues">
<h3>Classical Optimization Issues<a class="headerlink" href="#classical-optimization-issues" title="Link to this heading"></a></h3>
<p><strong>Convergence Problems</strong>:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;optimization&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;max_iterations&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">20000</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;tolerance&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">1e-10</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;initial_simplex_size&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.05</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Poor Parameter Estimates</strong>:
- Check initial parameter values
- Verify parameter bounds
- Ensure data quality is adequate</p>
<p><strong>Local Minima</strong>:
- Try multiple random starting points
- Use different initial simplex sizes
- Consider parameter scaling</p>
</section>
<section id="mcmc-issues">
<h3>MCMC Issues<a class="headerlink" href="#mcmc-issues" title="Link to this heading"></a></h3>
<p><strong>Poor Convergence</strong> (R-hat &gt; 1.1):</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;mcmc&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;tune&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2000</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;target_accept&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.95</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;chains&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Low Effective Sample Size</strong>:
- Increase number of samples
- Improve initial parameter estimates
- Check for parameter correlations</p>
<p><strong>Sampling Errors</strong>:
- Verify parameter bounds are reasonable
- Check for numerical stability issues
- Ensure adequate computational resources</p>
</section>
</section>
<section id="performance-optimization">
<h2>Performance Optimization<a class="headerlink" href="#performance-optimization" title="Link to this heading"></a></h2>
<section id="id5">
<h3>Classical Optimization<a class="headerlink" href="#id5" title="Link to this heading"></a></h3>
<p><strong>Speed Improvements</strong>:
- Enable Numba JIT compilation
- Use angle filtering for large datasets
- Optimize initial parameter estimates</p>
<p><strong>Memory Efficiency</strong>:
- Use <code class="docutils literal notranslate"><span class="pre">float32</span></code> for large datasets
- Enable result caching
- Manage intermediate results storage</p>
</section>
<section id="mcmc-sampling">
<h3>MCMC Sampling<a class="headerlink" href="#mcmc-sampling" title="Link to this heading"></a></h3>
<p><strong>Sampling Efficiency</strong>:
- Use good initial estimates from classical optimization
- Tune target acceptance rate (0.8-0.95)
- Adjust step size and adaptation parameters</p>
<p><strong>Computational Resources</strong>:
- Use multiple cores for parallel chains
- Monitor memory usage for large parameter spaces
- Consider distributed computing for very large problems</p>
</section>
</section>
<section id="validation-and-quality-assurance">
<h2>Validation and Quality Assurance<a class="headerlink" href="#validation-and-quality-assurance" title="Link to this heading"></a></h2>
<section id="result-validation">
<h3>Result Validation<a class="headerlink" href="#result-validation" title="Link to this heading"></a></h3>
<p><strong>Classical Results</strong>:
- Check convergence status (<code class="docutils literal notranslate"><span class="pre">results.success</span></code>)
- Verify reasonable chi-squared values
- Compare with expected parameter ranges</p>
<p><strong>MCMC Results</strong>:
- Monitor R-hat values (should be &lt; 1.1)
- Check effective sample sizes (&gt; 400 recommended)
- Examine trace plots for mixing</p>
</section>
<section id="cross-validation">
<h3>Cross-Validation<a class="headerlink" href="#cross-validation" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compare classical and MCMC results</span>
<span class="n">classical_params</span> <span class="o">=</span> <span class="n">classical_results</span><span class="o">.</span><span class="n">x</span>
<span class="n">mcmc_means</span> <span class="o">=</span> <span class="n">mcmc_results</span><span class="o">.</span><span class="n">posterior</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="n">relative_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">classical_params</span> <span class="o">-</span> <span class="n">mcmc_means</span><span class="p">)</span> <span class="o">/</span> <span class="n">mcmc_means</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Relative differences: </span><span class="si">{</span><span class="n">relative_diff</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Results should generally agree within uncertainties</span>
</pre></div>
</div>
<p>This comprehensive guide provides the foundation for effectively using both optimization methods in the homodyne package.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="configuration.html" class="btn btn-neutral float-left" title="Configuration System" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="scaling_optimization.html" class="btn btn-neutral float-right" title="Scaling Optimization" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Wei Chen, Hongrui He.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>